<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Print Annexure G report</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="js/config.js"></script>
</head>
<body>
<div id="sidebar-container"></div>
<div class="main-content">

  <h1>Print Annexure G report</h1>

  <form id="receiptForm">
    <div class="report-header">
      <div>
        <label>Select Date</label>
        <input type="date" id="examDate">
      </div>
      <div style="align-self:end;">
        <button type="button" id="goBtn">Go</button>
      </div>
    </div>
  </form>

  <div id="reportSection" style="display:none; margin-top:20px;">
    <div class="print-area" id="printArea">
      <h2 style="text-align:center;">Examination : Summer-2026</h2>

      <table border="1" width="100%" cellspacing="0" cellpadding="6">
        <thead>
          <tr>
            <th>Sr. No.</th>
            <th>Center Code</th>
            <th>Date of Exam</th>
            <th>Session</th>
            <th>Subject Details</th>
            <th>Total Packets</th>
            <th>Total Bundles</th>
          </tr>
        </thead>
        <tbody id="reportBody"></tbody>
      </table>

      <div style="margin-top:40px; display:flex; justify-content:space-between;">
        <div>
          Date: <span id="displayDate"></span> <br>
          Time: _________ AM/PM
        </div>
        <div style="text-align:right;">
          ( Signature ) <br>
          Officer-In-Charge
        </div>
      </div>
    </div>

    <div style="text-align:center; margin-top:20px;" class="no-print">
      <button onclick="window.print()" style="padding: 10px 25px; background: #007bff; color: white; border: none; cursor: pointer;">Print</button>
    </div>
  </div>
</div>
  
  <script src="js/sidebar.js"></script>
<script>
document.getElementById("goBtn").addEventListener("click", async function() {
  const date = document.getElementById("examDate").value;

  if (!date) {
    alert("Please select a date");
    return;
  }

  document.getElementById("displayDate").innerText = date;
  const tbody = document.getElementById("reportBody");
  tbody.innerHTML = "<tr><td colspan='7'>Loading...</td></tr>";

  try {
    // âœ… Fetching from Port 3001
    const res = await fetch(`http://localhost:3001/api/report/annexure-g?date=${date}`);
    const data = await res.json();

    tbody.innerHTML = "";
    if (data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='7'>No data found for this date.</td></tr>";
    } else {
      data.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>1644</td>
          <td>${date}</td>
          <td>${row.session || 'Morning'}</td>
          <td>${row.subject_name} (${row.subject_code})</td>
          <td>${row.total_packets}</td>
          <td>${row.total_bundles}</td>
        `;
        tbody.appendChild(tr);
      });
    }
    document.getElementById("reportSection").style.display = "block";
  } catch (err) {
    tbody.innerHTML = "<tr><td colspan='7' style='color:red'>Server Error. Ensure backend is running on Port 3001.</td></tr>";
  }
});
</script>
</body>
</html>